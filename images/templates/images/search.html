{% extends 'images/list.html' %}
{% load images_extras %}

{% block header %}{% if n >= 0 %}Results of your search{% if form.query != "" %} for {{ searchstring }}{% endif %}{% else %}Search public observations{% endif %}{%endblock%}
{% block title %}{% if n >= 0 %}Results of your search{% if form.query != "" %} for <em>&quot;{{ searchstring }}&quot;</em>{% endif %}{% else %}Search public observations{% endif %}{% endblock %}

{% block script-content %}
 <link rel="stylesheet" href="{{STATIC_URL}}css/jquery-ui.css">
 <script src="{{STATIC_URL}}js/jquery-ui.min.js"></script>
	<script>
	<!--
	categories = {{categorylookup|safe}}
	$(document).ready(function(){
		$('input#AVM').bind("keyup",function(e){
			if(categories[$(this).val()]) $('#avm_lookup').html(" &larr;"+categories[$(this).val()]+"")
			else $('#avm_lookup').html("")
		});
		$("#id_alldates").click(function(e){
			$('#searchdates').toggle();
		});
		$( ".datepicker" ).datepicker({
				dateFormat: "yy-mm-dd",
				defaultDate: 0,
				});
	});
	// -->
	</script>
{% endblock %}

{% block search %}{% if n >= 0 %}<div class="searchbox">
									<form action="{% url 'search' %}" method='GET'>
										<input type='text' name='query' class='searchbox' title='e.g. NGC 2020' /><input type='submit' value='Search' class='searchbtn' />
										<br /><span style='font-size:0.8em;'>[<a href="{% url 'search' %}">advanced search</a>]</span>
									</form>
{% if n > 1 %}
									<a href=""><img alt="Slideshow icon" title="Start slideshow of these observations" style="float: right;" src="{{ STATIC_URL }}img/rti_archive_slideshow.jpg"></a>
{% endif %}
								</div>{% else %}{% endif %}{% endblock %}

{% block breadcrumb %}
							<a href="{% url 'home' %}">Observations</a> &raquo; {% if n < 0 %}Search{% else %}<a href="{% url 'search' %}">Search</a> &raquo; Results{% endif %}
							<br />
{% endblock %}

{% block alternate-formats %}
{% if n > 0 %}
					<div class="row lastrow">
							<p>Alternative outputs: 
								<a title="View RSS feed" rel="alternate" type="application/xml" href="{%url 'search_api' format='rss'%}{% url_add_query %}">RSS</a>,
								<a title="View in Sky for Google Earth" rel="alternate" type="application/vnd.google-earth.kml+xml" href="{% url 'search_api' format='kml' %}">Sky for Google Earth</a>, and
								<a title="View in JSON format" rel="alternate" type="application/json" href="{% url 'search_api' format='json' %}">JSON</a>
							</p>
					</div>
{% endif %}
{% endblock %}

{% block main-content %}
{% if n > 0 %}
						<div class="row">
							<p>{%if onlyrti %}There {% if n > 1 %}are{% else %}is{% endif %} {{ n }} observation{% if n > 1 %}s{% endif %}.{%else%}Showing {{n}} observations taken between {{firstobs|relativetime}} and {{lastobs|relativetime}}. {% endif %}{% if n > 1 %} Newest observations are shown first.{% endif %}{% if avmcode %} You could also search for <a href="{% url 'show_avm' avm=avmcode %}">{{ avmname }}</a>.{% endif %}</p>
						</div>
						
						<div class="row">
							{% if pager %}
							<div class="pager">{{ pager|safe }}</div>
							{% endif %}
							<ul class='observation-results' data-json="{% url 'search_api' format='json' %}{% url_add_query %}" data-update="update" xmlns:dc='http://purl.org/dc/elements/1.1/' xmlns:UCD='http://www.ivoa.net/rdf/Vocabularies/UCD#'>
{% include "images/observationlist.html" with obs=obs %}
							</ul>
							{% if n > 18 and onlyrti %}
							<div class="pagination">
							    <span class="step-links">
							        <a href="{% url_add_query lastobs=lastobs %}">Next 18 of {{n}} &rarr;</a>
							    </span>
							</div>
							{% elif not onlyrti %}
							<div class="pagination">
							    <span class="step-links">
							        <a href="{% url_add_query lastobs=lastobs %}"> Older observations &rarr;</a>
							    </span>
							</div>
							{% endif %}
						</div>
{% else %}
		<div class="row">
			<div class="padder"></div>
{% if n == 0 %}
			<p>We found <strong>0</strong> results matching your search. Don't panic! Try making your search less specific.</p>
{% else %}
			<p>There are several ways to search through all our public observations. Use any combination of the options below to help narrow your search.</p>
{% endif %}
		</div>
{% if form.errors %}
		<div class="row">
		{{form.errors}}
		</div>
{% endif %}
		<form action="" method="get" id="rti-archive-form">
			<div class="row">
				<fieldset>
					<legend>By object name:</legend>
					<div class="twocol">
						<p class="gray-5">The name of a single astronomical object e.g. &quot;<em>Orion Nebula</em>&quot;. This is a simple title search so <em>Saturn</em> would match both &quot;<em>Saturn</em>&quot; and &quot;<em>NGC7009 (Saturn Nebula)</em>&quot;.</p>
					</div>
					<div class="fourcol lastcol">
						<label for="edit-ObName" class="hidden">Title: </label>{{form.query}}
						{% if form.query.errors  %}<span class="error form-error">{{form.query.errors.as_text}}</span>{% endif %}
					</div>
				</fieldset>
			</div>
			<div class="spacer"></div>
			<div class="row">
				<fieldset>
					<legend>By date range:</legend>
					<div class="twocol">
						<p class="gray-5">Limit your search to a particular range of dates.</p>
					</div>
					<div class="fourcol lastcol">
						<label class="option">All dates: {{form.alldates}}</label>
						<span id="searchdates">
						<label class="option inline">or use date range</label> <input type=text class="datepicker" name="startdate" value="{{form.startdate.value}}" /> to <input type=text class="datepicker" name="enddate" value="{{form.enddate.value}}"/>
						{% if form.startdate.errors or form.enddate.errors %}<span class="error form-error">{{form.startdate.errors.as_text}} {{form.enddate.errors.as_text}}</span>{% endif %}
						</span>
					</div>
				</fieldset>
			</div>
			<div class="spacer"></div>
			<!-- div class="row">
				<fieldset>
					<legend>By position: </legend>
					<div class="twocol">
						<p class="gray-5">Limit your search to a specific patch of sky by astronomical coordinates (Right Ascension and Declination). The search radius is limited to less than 10 degrees.</p>
					</div>
					<div class="fourcol lastcol">
							<label for="RA" class="inline">RA:</label> <input type="text" maxlength="15" name="RA" id="RA" value="{{ form.RA }}" class="form-text" style="width:5em;" /> ,
							<label for="DEC" class="inline">Dec:</label> <input type="text" maxlength="15" name="DEC" id="DEC" value="{{ form.DEC }}" class="form-text" style="width:5em;" /> ,
							<label for="SR" class="inline">radius (degrees):</label> <input type="text" maxlength="15" name="SR" id="SR" value="{{ form.SR }}" class="form-text" style="width:4em;" />
					</div>
				</fieldset>
			</div>
			<div class="spacer"></div-->
			<div class="row">
				<fieldset>
					<legend>By observatory site:</legend>
					<div class="twocol">
						<p class="gray-5">Limit your search to a specific observatory site.</p>
					</div>
					<div class="fourcol lastcol">
						<label for="edit-telid" class="hidden">Site: </label>{{form.sites}}
					</div>
				</fieldset>
			</div>
			<div class="spacer"></div>
			<div class="row">
				<fieldset>
					<legend>By wavelength filter:</legend>
					<div class="twocol">
						<p class="gray-5">Limit your search by the type of astronomical <a href="http://lcogt.net/network/instrumentation/filtertypes">filter</a>.</p>
					</div>
					<div class="fourcol lastcol">
						<label for="edit-filter" class="hidden">Wavelength filter: </label>{{form.filters}}
					</div>
				</fieldset>
			</div>
			<div class="spacer"></div>
			<div class="row">
				<fieldset>
					<legend>By exposure length: </legend>
					<div class="twocol">
						<p class="gray-5">Limit your search by the length of the exposure in seconds.</p>
					</div>
					<div class="fourcol lastcol">
						<label for="exposure" class="hidden">Exposure length: </label>
						{{form.exposurecondition}} {{form.exposure}} seconds
					</div>
				</fieldset>
			</div>
			<div class="row">
				<div class="twocol">
				</div>
				<div class="fourcol lastcol">
					<input type="submit" name="submit" id="edit-submit" value="Search" class="form-submit" />
				</div>
			</div>
		</form>
{% endif %}
{% endblock %}
