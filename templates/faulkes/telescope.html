{% extends 'faulkes/list.html' %}
{% load faulkes_extras %}

{% block script-content %}
	<meta http-equiv="X-UA-Compatible" content="IE=9" />
	<!--[if lt IE 9]><script src="http://lcogt.net/virtualsky/embed/excanvas.min.js" type="text/javascript"></script><![endif]-->
	<script type="text/javascript" src="http://lcogt.net/virtualsky/embed/virtualsky.min.js"></script>
	<script type="text/javascript">
	function spinOff(){
		planetarium.az_step = 0;
		if(typeof timer_az!='undefined') clearTimeout(timer_az);
	}
	window.onload = function(){
		planetarium = new $.virtualsky({id:'starmap',projection:'stereo',latitude:{{ telescope.site.latitude }},longitude:{{ telescope.site.longitude }},az:{% if telescope.site.latitude > 0 %}180{% else %}0{% endif %},gridlines_az:true,callback:{mouseenter:spinOff}});
		planetarium.draw();
		planetarium.az_step = -0.1;
		planetarium.moveIt();
		$.getJSON('{{ link }}.json?callback=?',function(data) {
			var obs = data.observation;
			for(var i = 0; i < obs.length ; i++){
				relative = relative_time(new Date(Date.parse(obs[i].time.creation)))
				a = planetarium.addPointer({ra:obs[i].ra,dec:obs[i].dec,label:obs[i].label+' ('+relative+')',img:obs[i].image.thumb,url:obs[i]._about,credit:obs[i].observer.label,colour:'rgb(255,255,255)'})
			}
			planetarium.draw();
		});
	};
	
	function relative_time(parsed_date) {
		var relative_to = (arguments.length > 1) ? arguments[1] : new Date();
		var delta = parseInt((relative_to.getTime() - parsed_date) / 1000);
		//delta = delta - (relative_to.getTimezoneOffset() * 60);
		if (delta < 60) return 'less than a minute ago';
		else if(delta < 120) return 'about a minute ago';
		else if(delta < (45*60)) return (parseInt(delta / 60)).toString() + ' minutes ago';
		else if(delta < (90*60)) return 'about an hour ago';
		else if(delta < (24*60*60)) {
			h = (parseInt(delta / 3600)).toString()
			if(h == 1) return 'about ' + h + ' hour ago';
			else return 'about ' + h + ' hours ago';
		} else if(delta < (48*60*60)) return '1 day ago';
		else return (parseInt(delta / 86400)).toString() + ' days ago';
	}
	</script>
{% endblock %}
{%block header %}{{ telescope.name }}{%endblock%}
{%block title %}{{ telescope.name }}{%endblock%}

{% block breadcrumb %}
								<div class="breadcrumb">
									<a href="{% url rtiadminsite.faulkes.views.index %}">Observations</a> &raquo; <a href="{% url rtiadminsite.faulkes.views.index %}{{ telescope.site.code }}">{{ telescope.site.name }}</a> &raquo; {% if telescope.short %}{{ telescope.short }}{% else %}{{ telescope.name }}{% endif %}
								</div>
{% endblock %}

{% block telescopes-list-title %}Nearby Telescopes:{% endblock %}
{% block sites-list-title %}Other sites:{% endblock %}

{% block main-content %}
						<div class="row">
							<p>Below are the most recent observations taken by {% if telescope.drupalnode %}<a href="http://lcogt.net/node/{{ telescope.drupalnode }}">{{ telescope.name }}</a>{% else %}{{ telescope.name }}{% endif %} based at {%if telescope.site.drupalnode %}<a href="http://lcogt.net/node/{{ telescope.site.drupalnode }}">{{ telescope.site.name }}</a>{% else %}{{ telescope.site.name }}{% endif %}:</p>
							{% if input.pager.start < 1 %}<div id="starmap" class="sixcol" style="height:300px;"></div>{% endif %}
						</div>
						<div class="row">
							{% if pager %}
							<div class="pager">{{ pager|safe }}</div>
							{% endif %}

							<ul class='observation-results' data-json="{% url rtiadminsite.faulkes.views.index %}{{ link }}.json{% if input.pager.page > 1 %}?page={{input.pager.page}}{% endif %}" data-update="update" xmlns:dc='http://purl.org/dc/elements/1.1/' xmlns:UCD='http://www.ivoa.net/rdf/Vocabularies/UCD#'>
{% include "faulkes/observationlist.html" with obs=obs %}
							</ul>
							{% if pager %}
							<div class="pager">{{ pager|safe }}</div>
							{% endif %}
						</div>
{% endblock %}

